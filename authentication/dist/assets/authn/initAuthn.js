async function o({method:e,email:t=null}){let{codeVerifier:n,codeChallenge:r,state:c}=await new Promise(l=>{pkceWorker.postMessage({cmd:"generatePkce"}),pkceWorker.onmessage=d=>l(d.data)}),a=location.protocol==="https:"?"Secure; SameSite=Lax":"SameSite=Lax";document.cookie=`pkce_verifier=${n}; Path=/; ${a}`,document.cookie=`oauth_state=${c}; Path=/; ${a}`,document.cookie=`authn_method=${e}; Path=/; ${a}`;let i=`/authn/${e}?code_challenge=${r}&state=${c}`;e==="magic-link"&&(i+=`&email=${encodeURIComponent(t)}`),window.location.href=i}globalThis.pkceWorker=new Worker("/authn/pkceWorker.js");document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("email"),t="";e.addEventListener("input",n=>{t=n.target.value.trim()}),document.getElementById("google").addEventListener("click",()=>{o({method:"google"})}),document.getElementById("microsoft").addEventListener("click",()=>{o({method:"ms"})}),document.getElementById("magic-link").addEventListener("click",()=>{o({method:"magic-link",email:t})})});
